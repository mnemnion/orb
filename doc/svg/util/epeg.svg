<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: lpegNode Pages: 1 -->
<svg width="861pt" height="2082pt"
 viewBox="0.00 0.00 861.00 2081.60" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 2077.6026)">
<title>lpegNode</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-2077.6026 857,-2077.6026 857,4 -4,4"/>
<!-- doc_0 -->
<g id="node1" class="node">
<title>doc_0</title>
<ellipse fill="none" stroke="#000000" cx="270" cy="-2055.6026" rx="46.9581" ry="18"/>
<text text-anchor="middle" x="270" y="-2051.4026" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">doc &#45; 120</text>
</g>
<!-- section_1 -->
<g id="node2" class="node">
<title>section_1</title>
<ellipse fill="none" stroke="#000000" cx="270" cy="-1983.6026" rx="65.8187" ry="18"/>
<text text-anchor="middle" x="270" y="-1979.4026" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 1&#45;120</text>
</g>
<!-- doc_0&#45;&gt;section_1 -->
<g id="edge1" class="edge">
<title>doc_0&#45;&gt;section_1</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M270,-2037.434C270,-2029.7336 270,-2020.577 270,-2012.0193"/>
<polygon fill="#000000" stroke="#000000" points="273.5001,-2012.0159 270,-2002.0159 266.5001,-2012.0159 273.5001,-2012.0159"/>
</g>
<!-- header_2 -->
<g id="node3" class="node">
<title>header_2</title>
<ellipse fill="none" stroke="#000000" cx="177" cy="-1911.6026" rx="43.0992" ry="18"/>
<text text-anchor="middle" x="177" y="-1907.4026" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">1 : Epeg</text>
</g>
<!-- section_1&#45;&gt;header_2 -->
<g id="edge2" class="edge">
<title>section_1&#45;&gt;header_2</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M247.9603,-1966.5396C235.3275,-1956.7594 219.3277,-1944.3724 205.7196,-1933.8372"/>
<polygon fill="#000000" stroke="#000000" points="207.6571,-1930.9109 197.6073,-1927.5566 203.3719,-1936.4459 207.6571,-1930.9109"/>
</g>
<!-- prose_3 -->
<g id="node4" class="node">
<title>prose_3</title>
<ellipse fill="none" stroke="#000000" cx="270" cy="-1911.6026" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="270" y="-1907.4026" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_3 -->
<g id="edge3" class="edge">
<title>section_1&#45;&gt;prose_3</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M270,-1965.434C270,-1957.7336 270,-1948.577 270,-1940.0193"/>
<polygon fill="#000000" stroke="#000000" points="273.5001,-1940.0159 270,-1930.0159 266.5001,-1940.0159 273.5001,-1940.0159"/>
</g>
<!-- codeblock_4 -->
<g id="node5" class="node">
<title>codeblock_4</title>
<ellipse fill="none" stroke="#000000" cx="484" cy="-1911.6026" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="484" y="-1907.4026" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 6&#45;120</text>
</g>
<!-- section_1&#45;&gt;codeblock_4 -->
<g id="edge4" class="edge">
<title>section_1&#45;&gt;codeblock_4</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M311.5151,-1969.6349C345.3229,-1958.2603 393.3025,-1942.1177 430.0788,-1929.7443"/>
<polygon fill="#000000" stroke="#000000" points="431.2896,-1933.0298 439.6515,-1926.5236 429.0574,-1926.3953 431.2896,-1933.0298"/>
</g>
<!-- leaf_5 -->
<g id="node6" class="node">
<title>leaf_5</title>
<polygon fill="none" stroke="#c0c0c0" points="206,-1000.2013 148,-1000.2013 148,-964.2013 206,-964.2013 206,-1000.2013"/>
<text text-anchor="middle" x="177" y="-978.7014" font-family="Inconsolata" font-size="14.00" fill="#000000">* Epeg</text>
</g>
<!-- header_2&#45;&gt;leaf_5 -->
<g id="edge5" class="edge">
<title>header_2&#45;&gt;leaf_5</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M177,-1893.4542C177,-1778.4897 177,-1151.7808 177,-1010.5019"/>
<polygon fill="#000000" stroke="#000000" points="180.5001,-1010.4661 177,-1000.4661 173.5001,-1010.4661 180.5001,-1010.4661"/>
</g>
<!-- raw_6 -->
<g id="node7" class="node">
<title>raw_6</title>
<ellipse fill="none" stroke="#000000" cx="260" cy="-982.2013" rx="27" ry="18"/>
<text text-anchor="middle" x="260" y="-978.0013" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_3&#45;&gt;raw_6 -->
<g id="edge6" class="edge">
<title>prose_3&#45;&gt;raw_6</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M269.8047,-1893.4542C268.5678,-1778.4897 261.8246,-1151.7808 260.3045,-1010.5019"/>
<polygon fill="#000000" stroke="#000000" points="263.804,-1010.4278 260.1965,-1000.4661 256.8044,-1010.5032 263.804,-1010.4278"/>
</g>
<!-- leaf_8 -->
<g id="node9" class="node">
<title>leaf_8</title>
<polygon fill="none" stroke="#c0c0c0" points="853,-1857.5039 305,-1857.5039 305,-106.8988 853,-106.8988 853,-1857.5039"/>
<text text-anchor="middle" x="579" y="-1842.4026" font-family="Inconsolata" font-size="14.00" fill="#000000">local lpeg = require &quot;lpeg&quot;</text>
<text text-anchor="middle" x="579" y="-1811.0026" font-family="Inconsolata" font-size="14.00" fill="#000000">local function makerange(first, second)</text>
<text text-anchor="middle" x="579" y="-1795.6026" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local patts = {}</text>
<text text-anchor="middle" x="579" y="-1780.2025" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local patt &#160;= {}</text>
<text text-anchor="middle" x="579" y="-1764.8025" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if (second) then</text>
<text text-anchor="middle" x="579" y="-1749.4025" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if (string.len(first) == string.len(second)) then</text>
<text text-anchor="middle" x="579" y="-1734.0024" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;for i = 1, string.len(first) do</text>
<text text-anchor="middle" x="579" y="-1718.6024" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;patts[i] = lpeg.R(string.sub(first,i,i)..string.sub(second,i,i))</text>
<text text-anchor="middle" x="579" y="-1703.2024" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="579" y="-1687.8023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;patt = patts[1]</text>
<text text-anchor="middle" x="579" y="-1672.4023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;for i = 2, string.len(first) do</text>
<text text-anchor="middle" x="579" y="-1657.0023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;patt = patt + patts[i]</text>
<text text-anchor="middle" x="579" y="-1641.6022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="579" y="-1626.2022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return patt</text>
<text text-anchor="middle" x="579" y="-1610.8022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="579" y="-1595.4022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;error(&quot;Ranges must be of equal byte width&quot;)</text>
<text text-anchor="middle" x="579" y="-1580.0021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return {}</text>
<text text-anchor="middle" x="579" y="-1564.6021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="579" y="-1549.2021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;else</text>
<text text-anchor="middle" x="579" y="-1533.802" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return lpeg.R(first)</text>
<text text-anchor="middle" x="579" y="-1518.402" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="579" y="-1503.002" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="579" y="-1455.6019" font-family="Inconsolata" font-size="14.00" fill="#000000">local function num_bytes(str)</text>
<text text-anchor="middle" x="579" y="-1440.2019" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45;&#45;returns the number of bytes in the next character in str</text>
<text text-anchor="middle" x="579" y="-1424.8019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local c = str:byte(1)</text>
<text text-anchor="middle" x="579" y="-1409.4018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if c &gt;= 0x00 and c &lt;= 0x7F then</text>
<text text-anchor="middle" x="579" y="-1394.0018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return 1</text>
<text text-anchor="middle" x="579" y="-1378.6018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;elseif c &gt;= 0xC2 and c &lt;= 0xDF then</text>
<text text-anchor="middle" x="579" y="-1363.2017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return 2</text>
<text text-anchor="middle" x="579" y="-1347.8017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;elseif c &gt;= 0xE0 and c &lt;= 0xEF then</text>
<text text-anchor="middle" x="579" y="-1332.4017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return 3</text>
<text text-anchor="middle" x="579" y="-1317.0017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;elseif c &gt;= 0xF0 and c &lt;= 0xF4 then</text>
<text text-anchor="middle" x="579" y="-1301.6016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return 4</text>
<text text-anchor="middle" x="579" y="-1286.2016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="579" y="-1270.8016" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="579" y="-1239.4015" font-family="Inconsolata" font-size="14.00" fill="#000000">local function Su (str)</text>
<text text-anchor="middle" x="579" y="-1224.0015" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45;&#45;[[</text>
<text text-anchor="middle" x="579" y="-1208.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45;convert a &#39;set&#39; pattern to uniquely match the characters</text>
<text text-anchor="middle" x="579" y="-1193.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45;in the range.</text>
<text text-anchor="middle" x="579" y="-1177.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local catch = {}</text>
<text text-anchor="middle" x="579" y="-1162.4014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local i = 0</text>
<text text-anchor="middle" x="579" y="-1147.0013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;for i = 1, #str do</text>
<text text-anchor="middle" x="579" y="-1131.6013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;catch[i]</text>
<text text-anchor="middle" x="579" y="-1116.2013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="579" y="-1100.8012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45;]]</text>
<text text-anchor="middle" x="579" y="-1085.4012" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="579" y="-1054.0012" font-family="Inconsolata" font-size="14.00" fill="#000000">local function spanner(first, last, str, root)</text>
<text text-anchor="middle" x="579" y="-1038.6012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local vals = {}</text>
<text text-anchor="middle" x="579" y="-1023.2011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;vals.span = true</text>
<text text-anchor="middle" x="579" y="-1007.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;vals.val = string.sub(str, first, last &#45; 1)</text>
<text text-anchor="middle" x="579" y="-992.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;vals.first = first</text>
<text text-anchor="middle" x="579" y="-977.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;vals.last = last &#45; 1</text>
<text text-anchor="middle" x="579" y="-961.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if vals.last &gt;= vals.first then</text>
<text text-anchor="middle" x="579" y="-946.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return vals</text>
<text text-anchor="middle" x="579" y="-930.8009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="579" y="-915.4009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; If a capture contains nothing, we don&#39;t want a node for it</text>
<text text-anchor="middle" x="579" y="-900.0009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return nil</text>
<text text-anchor="middle" x="579" y="-884.6008" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="579" y="-853.2008" font-family="Inconsolata" font-size="14.00" fill="#000000">local function Csp (patt)</text>
<text text-anchor="middle" x="579" y="-837.8008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return lpeg.Cp()</text>
<text text-anchor="middle" x="579" y="-822.4007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;* lpeg.Cmt(patt, function() return true end)</text>
<text text-anchor="middle" x="579" y="-807.0007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;* lpeg.Cp()</text>
<text text-anchor="middle" x="579" y="-791.6007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;* lpeg.Carg(1)</text>
<text text-anchor="middle" x="579" y="-776.2007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;* lpeg.Carg(2) / spanner</text>
<text text-anchor="middle" x="579" y="-760.8006" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="579" y="-665.4006" font-family="Inconsolata" font-size="14.00" fill="#000000">local function split (s, sep)</text>
<text text-anchor="middle" x="579" y="-650.0006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;sep = lpeg.P(sep)</text>
<text text-anchor="middle" x="579" y="-634.6005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;local elem = lpeg.C((1 &#45; sep)^0)</text>
<text text-anchor="middle" x="579" y="-619.2005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;local p = lpeg.Ct(elem * (sep * elem)^0) &#160;&#160;&#45;&#45; make a table capture</text>
<text text-anchor="middle" x="579" y="-603.8005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;return lpeg.match(p, s)</text>
<text text-anchor="middle" x="579" y="-588.4004" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="579" y="-365.0004" font-family="Inconsolata" font-size="14.00" fill="#000000">local I = lpeg.Cp()</text>
<text text-anchor="middle" x="579" y="-333.6004" font-family="Inconsolata" font-size="14.00" fill="#000000">local function &#160;anyP(p)</text>
<text text-anchor="middle" x="579" y="-318.2003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;return lpeg.P{ I * p * I + 1 * lpeg.V(1) }</text>
<text text-anchor="middle" x="579" y="-302.8003" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="579" y="-239.4003" font-family="Inconsolata" font-size="14.00" fill="#000000">local Ru = makerange</text>
<text text-anchor="middle" x="579" y="-192.0002" font-family="Inconsolata" font-size="14.00" fill="#000000">return { R = Ru,</text>
<text text-anchor="middle" x="579" y="-176.6002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;Csp = Csp,</text>
<text text-anchor="middle" x="579" y="-161.2002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;anyP = anyP,</text>
<text text-anchor="middle" x="579" y="-145.8002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;match = lpeg.match,</text>
<text text-anchor="middle" x="579" y="-130.4001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;split = split,</text>
<text text-anchor="middle" x="579" y="-115.0001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;spanner = spanner }</text>
</g>
<!-- codeblock_4&#45;&gt;leaf_8 -->
<g id="edge8" class="edge">
<title>codeblock_4&#45;&gt;leaf_8</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M485.8551,-1893.4542C486.5591,-1886.5668 487.4508,-1877.8426 488.5084,-1867.4962"/>
<polygon fill="#000000" stroke="#000000" points="491.9905,-1867.8485 489.5256,-1857.5444 485.0268,-1867.1366 491.9905,-1867.8485"/>
</g>
<!-- leaf_7 -->
<g id="node8" class="node">
<title>leaf_7</title>
<polygon fill="none" stroke="#c0c0c0" points="520,-70.7004 0,-70.7004 0,-.0997 520,-.0997 520,-70.7004"/>
<text text-anchor="middle" x="260" y="-23.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">Deprecated library used in various places in the Orb codebase, not worth</text>
<text text-anchor="middle" x="260" y="-8.2" font-family="Inconsolata" font-size="14.00" fill="#000000">the hassle to remove at this time.</text>
</g>
<!-- raw_6&#45;&gt;leaf_7 -->
<g id="edge7" class="edge">
<title>raw_6&#45;&gt;leaf_7</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M260,-964.1332C260,-852.1364 260,-251.8797 260,-80.8852"/>
<polygon fill="#000000" stroke="#000000" points="263.5001,-80.7177 260,-70.7177 256.5001,-80.7177 263.5001,-80.7177"/>
</g>
</g>
</svg>
